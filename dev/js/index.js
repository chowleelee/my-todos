!function(){function n(){s.on("submit",function(n){n.preventDefault(),s.find("input").eq(0).val()&&(k.push({content:s.find("input").eq(0).val()}),s.find("input").eq(0).val(""),t())})}function t(){h.empty();for(var t=[],l=0;l<k.length;l++){var d=e(k[l],l);k[l].complete&&1==k[l].complete?(d.addClass("complete"),d.find(".checkbox").prop("checked",!0),t.push(d)):(h.prepend(d),o())}for(l=0;l<t.length;l++)h.append(t[l]);i(),n(),c(),a()}function e(n,t){var e="";return e+='<li data-value="'+t+'">',e+='<div class="left">',e+='<input class="checkbox" type="checkbox">',e+="<span>"+n.content+"</span>",e+="</div>",e+='<div class="right">',e+='<span class="delBtn">删除</span>',e+='<span class="infoBtn">详情</span>',e+="</div>",e+="</li>",$(e)}function i(){store.set("message",k),f()}function c(){h.find(".right .delBtn").unbind().on("click",function(){var n=parseInt($(this).parent().parent().data("value"));m.show(),m.find(".yes").unbind().on("click",function(){k=k.slice(0,n).concat(k.slice(n+1,k.length)),m.hide(),t()}),m.find(".no").unbind().on("click",function(){m.hide()})})}function a(){h.find(".left .checkbox").unbind().on("click",function(){var n=parseInt($(this).parent().parent().data("value"));$(this).is(":checked")?($(this).parent().parent().addClass("complete"),k[n].complete=!0):($(this).parent().parent().removeClass("complete"),k[n].complete=!1),t()})}function o(){h.find(".right .infoBtn").unbind().on("click",function(n){(event||n).cancelBubble=!0;var t=parseInt($(this).parent().parent().data("value"));p.show(),b.hide(),p.find("h2").html(k[t].content),p.find("textarea").val(k[t].detail?k[t].detail:""),p.find("input").eq(1).val(k[t].time?k[t].time:""),d(),l(t)}),p.on("click",function(n){(event||n).cancelBubble=!0}),$(document).on("click",function(){p.hide(),b.hide()})}function l(n){v.unbind().on("click",function(){k[n].content=p.find("h2").html()?p.find("h2").html():"",k[n].detail=p.find("textarea").val()?p.find("textarea").val():"",k[n].time=p.find("input").eq(1).val()?p.find("input").eq(1).val():"",t()})}function d(){p.find("h2").on("dblclick",function(){$(this).hide(),p.find("input").eq(0).show(),p.find("input").eq(0).focus()}),p.find("input").eq(0).on("blur",function(){$(this).hide(),p.find("h2").show().html($(this).val()?$(this).val():p.find("h2").html())})}function f(){for(var n=0;n<k.length;n++)if(0!=k[n].complete&&k[n].time&&!(new Date(k[n].time).getTime()<=(new Date).getTime())){var t=new Date(k[n].time).getTime();clearInterval(k[n].timer),k[n].timer=setInterval(function(n){return function(){var e=(new Date).getTime();t-e<=0&&(g.show(),g.find(".msg-content").html(k[n].content),u(),r(n),clearInterval(k[n].timer))}}(n),500)}}function r(n){g.find(".confirmed").unbind().on("click",function(){g.hide(),k[n].off=!0,i()})}function u(){document.getElementById("alerter").play()}var s=$(".container .add"),h=$(".container .content .list"),p=$(".container .content .info"),m=$(".container .content .alert"),v=$(".container .content .info .update"),b=$(".container .content .mask"),g=$(".msg"),k=[];k=store.get("message")||[],t()}();