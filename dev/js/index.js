function init(){message=store.get("message")||[],bind()}function submit(){$add.on("submit",function(e){e.preventDefault(),$add.find("input").eq(0).val()&&(message.push({content:$add.find("input").eq(0).val()}),$add.find("input").eq(0).val(""),bind())})}function bind(){$list.empty(),key=0;for(var e=[],n=0;n<message.length;n++){var t=html(message[n]);message[n].complete&&1==message[n].complete?(t.addClass("complete"),t.find(".checkbox").attr("checked",!0),e.push(t)):$list.prepend(t)}for(n=0;n<e.length;n++)$list.append(e[n]);storeData()}function html(e){var n="";return n+='<li data-value="'+key+++'">',n+='<div class="left">',n+='<input class="checkbox" type="checkbox">',n+="<span>"+e.content+"</span>",n+="</div>",n+='<div class="right">',n+='<span class="delBtn">删除</span>',n+='<span class="infoBtn">详情</span>',n+="</div>",n+="</li>",$(n)}function storeData(){store.set("message",message),alarm()}function del(){$list.on("click",".right .delBtn",function(){var e=parseInt($(this).parent().parent().attr("data-value"));$alert.show(),$alert.on("click",".yes",function(){message=message.slice(0,e).concat(message.slice(e+1,message.length)),bind(),$alert.hide()}),$alert.on("click",".no",function(){$alert.hide()})})}function check(){$list.on("click",".left .checkbox",function(){var e=parseInt($(this).parent().parent().attr("data-value"));$(this).is(":checked")?($(this).parent().parent().addClass("complete"),message[e].complete=!0):($(this).parent().parent().removeClass("complete"),message[e].complete=!1),bind()})}function info(){$list.on("click",".right .infoBtn",function(e){(event||e).cancelBubble=!0;var n=parseInt($(this).parent().parent().attr("data-value"));$info.show(),$mask.hide(),$info.find("h2").html(message[n].content),$info.find("textarea").val(message[n].detail?message[n].detail:""),$info.find("input").eq(1).val(message[n].time?message[n].time:""),modify(),update(n)}),$info.on("click",function(e){(event||e).cancelBubble=!0}),$(document).on("click",function(){$info.hide(),$mask.hide()})}function update(e){$update.unbind().on("click",function(){message[e].content=$info.find("h2").html()?$info.find("h2").html():"",message[e].detail=$info.find("textarea").val()?$info.find("textarea").val():"",message[e].time=$info.find("input").eq(1).val()?$info.find("input").eq(1).val():"",bind()})}function modify(){$info.find("h2").on("dblclick",function(){$(this).hide(),$info.find("input").eq(0).show(),$info.find("input").eq(0).focus()}),$info.find("input").eq(0).on("blur",function(){$(this).hide(),$info.find("h2").show().html($(this).val()?$(this).val():$info.find("h2").html())})}function alarm(){for(var e=0;e<message.length;e++)if(0!=message[e].complete&&message[e].time&&!(new Date(message[e].time).getTime()<=(new Date).getTime())){var n=new Date(message[e].time).getTime();clearInterval(message[e].timer),message[e].timer=setInterval(function(e){return function(){var t=(new Date).getTime();n-t<=0&&($msg.show(),$msg.find(".msg-content").html(message[e].content),clearInterval(message[e].timer))}}(e),500)}}var $add=$(".container .add"),$list=$(".container .content .list"),$info=$(".container .content .info"),$alert=$(".container .content .alert"),$update=$(".container .content .info .update"),$mask=$(".container .content .mask"),$msg=$(".msg"),message=[],key=0;init(),submit(),del(),check(),info();